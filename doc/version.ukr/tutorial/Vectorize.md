# Векторизація рутин

Як використовувати рутину <code>vectorize</code> для векторизації скалярних рутин.

Рутини, що здійснюють операції зі скалярними даними можна автоматично векторизувати з допомогою рутини `vectorize`. Векторизована рутина може оброблювати передані дані в вигляді [векторів](../concept/Vector.md).

<details>
  <summary><u>Структура файлів</u></summary>

```
vectorize
   ├── Sum.js
   └── package.json

```

</details>

Створіть приведену конфігурацію для дослідження векторизації скалярних рутин з допомогою `vectorize`.

<details>
    <summary><u>Код файла <code>package.json</code></u></summary>

```json    
{
  "dependencies": {
    "wTools": ""
  }
}

```

</details>

Рутина `vectorize` належить до модуля `Tools`. Скопіюйте приведений вище код в файл `package.json` та встановіть залежності з допомогою команди `npm install`. Після встановлення залежностей модуль буде готовий до роботи.

### Векторизація рутини з налаштуваннями за замовчуванням

Для демонстрації можливості рутини `vectorize` розв'яжемо задачу.

Потрібно попарно просумувати числа з двох векторів, при цьому реалізація для сумування скалярних величин вже існує:

```js
function sum( a, b )
{
  return Number( a ) + Number( b );
}
```

Код рутини `sum` показує, що вона повертає суму двох чисел, а при передачі інших типів даних, в тому числі, векторів даних - `NaN`. Рутина не містить обмежень кількості аргументів та їх типу.

<details>
  <summary><u>Код файла <code>Sum.js</code></u></summary>

```js
// dependencies
let _ = require( 'wTools' );

// scalar routine
function sum( a, b )
{
  return Number( a ) + Number( b );
}

// manually written vectorized routine
function sum_v1( a, b )
{
  let result = [];
  for( let i = 0; i < a.length; i++ )
  result[ i ] = sum( a[ i ], b[ i ] );
  return result;
}

// automatically vectorized routine by vectorize()
let sum_v2 = _.vectorize( sum, 2 );

// vectors
let a = [ 1, 3, 4, 6, 9 ];
let b = [ 4, 1, 0, 7, 3 ];

// log results
console.log( sum_v1( a, b ) );
console.log( sum_v2( a, b ) );
```

</details>

Внесіть приведений код в файл `Sum.js`.

В файлі `Sum.js` виконано векторизацію рутини `sum` двома способами. Перший - ручне написання векторизованої рутини, другий - автоматичне.

Рутина `sum_v1` використовує код рутини `sum` при додаванні елементів з однаковими індексами - це приклад простої реалізації векторизації. Тим не менше, для її написання потрібно щонайменше чотири рядки.

Другий спосіб - векторизація з допомогою рутини `vectorize`, що займає лише один рядок коду. Для його реалізації змінній `sum_v2` присвоєно результат виконання рутини `vectorize`:

```js
let sum_v2 = _.vectorize( sum, 2 );
```

Рутина `vectorize` приймає два аргументи: перший з них - власне, рутина для векторизації, другий - встановлює кількість аргументів, що приймає векторизована рутина. Тому, в аргументах `vectorize` першою передано рутину `sum`, а другим аргументом указано, що рутина `sum_v2` повинна приймати два аргументи.

<details>
  <summary><u>Вивід команди <code>node Sum.js</code></u></summary>

```
$ node Sum.js
[ 5, 4, 4, 13, 12 ]
[ 5, 4, 4, 13, 12 ]
```

</details>

Тож, перевірте як працюють векторизовані рутини. В директорії з файлом `Sum.js` виконайте команду `node Sum.js`. Порівняйте результати з приведеними вище.

В консолі видно, що і рутина `sum_v1`, i `sum_v2` повернули однаковий результат, це було очікувано.

Спробуйте передати рутинам скалярні дані.

```js
let a = 1;
let b = 2;
```

Змініть значення змінних `a` i `b` як показано вище. Збережіть файл, та запустіть команду `node Sum.js`.

<details>
  <summary><u>Вивід команди <code>node Sum.js</code></u></summary>

```
$ node Sum.js
[]
3
```

</details>

Рутина `sum_v1` повернула порожній масив, адже передані дані не є векторами, а рутина `sum_v2` повернула скалярний результат. Тобто, рутини, векторизовані з допомогою `vectorize` можуть працювати як скалярні.

Тепер змініть вектори `a` i `b`, щоб вони мали різну довжину. В файлі `Sum.js` замініть рядки з векторами на приведені

```js
let a = [ 1, 3, 4, 6, 9 ];
let b = [ 4, 1, 0, 7 ];
```

Після збереження оновленого файла, повторіть ввід команди `node Sum.js`

<details>
  <summary><u>Вивід команди <code>node Sum.js</code> при різній довжині векторів</u></summary>

```
$ node Sum.js
[ 5, 4, 4, 13, NaN ]
------------------------------- unhandled errorr ------------------------------->

 * Application
Current path : /some/path/to/file
Exec path : /usr/bin/node /some/path/to/file/Sum.js

 = Message
Vector should have 5 elements, but have 4

... error log
------------------------------- unhandled errorr -------------------------------<
```

</details>

Рутина `sum_v1`, просумувала наявні елементи та вивела масив. В векторі `b` відсутній п'ятий елемент, тому в поверненому масиві останній елемент має значення `NaN`. За правилами, при виконанні операції над декількома векторами їх довжина має бути однаковою, тому рутина `sum_v1` видала некоректний результат. Очевидно, що програмісту при створенні рутини `sum_v1` довелось би встановити умову еквівалентності довжин векторів. Ця умова автоматично додана рутиною `vectorize` в рутину `sum_v2`. Тому, слідом за виводом рутини `sum_v1` викинуто помилку. Повідомлення говорить про різну довжину векторів

```
Vector should have 5 elements, but have 4
```

Ще однією позитивною стороною використання рутини `vectorize` є можливість встановлення кількості аргуметів, що мають передаватись. В рутині `sum_v2` воно встановлене числом `2`.

```js
console.log( sum_v1( a, a, a ) );
console.log( sum_v2( b, b, b ) );
```

Замініть останні рядки файла `Sum.js` на приведені вище. Після збереження оновленого файла, введіть команду `node Sum.js`

<details>
  <summary><u>Вивід команди <code>node Sum.js</code> при передачі трьох аргументів в векторизовані рутини</u></summary>

```
$ node Sum.js
[ 2, 6, 8, 12, 18 ]
------------------------------- unhandled errorr ------------------------------->

 * Application
Current path : /some/path/to/file
Exec path : /usr/bin/node /some/path/to/file/Sum.js

 = Message
Expects 2 arguments, but got 3

... error log
------------------------------- unhandled errorr -------------------------------<
```

</details>

Рутина `sum_v1` успішно виконала операцію з першими двома аргументами, а третій проігнорувала. Рутина `sum_v2` викинула помилку, так як кількість переданих аргументів відрізняється від очікуваної

```
Expects 2 arguments, but got 3
```

Приведений приклад розкриває базові можливості рутини `vectorize`, поглиблене розуміння можна отримати пройшовши туторіал по використанню [опцій рутини `vectorize`](VectorizeOptions.md).

### Підсумок

- Рутина `vectorize` дозволяє автоматично створювати векторизовані рутини зі скалярних.
- Рутина, котра створена з допомогою `vectorize` може виконувати операції зі скалярними величинами так же, як скалярна рутина.
- Рутина `vectorize` може встановлювати кількість аргументів для векторизованої рутини.
- В векторизовані рутини додається перевірка переданих векторів на співрозмірність їх довжин.

[Повернутись до змісту](../README.md#Туторіали)
